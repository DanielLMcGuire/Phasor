.TH PHIR 5 "January 2026" "Phasor 4.0.0" "Phasor File Formats"
.SH NAME
phir \- Phasor Intermediate Representation format
.SH DESCRIPTION
The
.B .phir
file format is a human-readable text-based intermediate representation of compiled Phasor bytecode. It serves as a middle ground between source code and binary bytecode, allowing developers to inspect, analyze, and manually modify compiled programs.
.PP
PHIR files are structured text documents containing serialized bytecode instructions, constant pools, variable mappings, function entries, and struct definitions. The format uses a versioned header and section-based organization.
.SH FILE STRUCTURE
A PHIR file consists of the following sections in order:
.PP
.B 1. Header
.RS
The file begins with a magic identifier and version number:
.PP
.nf
.RS
\&.PHIR 4.0.0
.RE
.fi
.RE
.PP
.B 2. Constants Section
.RS
Defines all constant values used in the program:
.PP
.nf
.RS
\&.CONSTANTS <count>
NULL
BOOL true|false
INT <integer_value>
FLOAT <float_value>
STRING "<escaped_string>"
.RE
.fi
.RE
.PP
.B 3. Variables Section
.RS
Maps variable names to their indices:
.PP
.nf
.RS
\&.VARIABLES <count> <next_index>
<name> <index>
...
.RE
.fi
.RE
.PP
.B 4. Functions Section
.RS
Maps function names to their entry point addresses:
.PP
.nf
.RS
\&.FUNCTIONS <count>
<name> <address>
...
.RE
.fi
.RE
.PP
.B 5. Structs Section
.RS
Defines struct types with their fields:
.PP
.nf
.RS
\&.STRUCTS <count>
<name> <first_const_idx> <field_count> <field1> <field2> ...
...
.RE
.fi
.RE
.PP
.B 6. Instructions Section
.RS
Contains the actual bytecode instructions:
.PP
.nf
.RS
\&.INSTRUCTIONS <count>
<opcode> [operands...]  ; optional comment
...
.RE
.fi
.RE
.SH INSTRUCTION FORMAT
Instructions follow this general format:
.PP
.nf
.RS
OPCODE [operand1[, operand2[, operand3]]]  ; comment
.RE
.fi
.PP
Operands can be:
.RS
.IP \(bu 2
Plain integers for immediate values or indices
.IP \(bu 2
Registers in the form
.B rN
where N is the register number
.IP \(bu 2
Constant pool indices
.IP \(bu 2
Variable indices
.IP \(bu 2
Function addresses
.RE
.PP
Comments are automatically generated to show:
.RS
.IP \(bu 2
Constant values for constant pool references
.IP \(bu 2
Variable names for variable indices
.IP \(bu 2
Function names for function addresses
.RE
.SH OPCODES
The PHIR format supports a comprehensive instruction set including:
.PP
.B Stack Operations
.RS
PUSH_CONST, POP, PUSH_R, POP_R, PUSH2_R, POP2_R
.RE
.PP
.B Arithmetic Operations
.RS
IADD, ISUBTRACT, IMULTIPLY, IDIVIDE, IMODULO (integer)
.br
FLADD, FLSUBTRACT, FLMULTIPLY, FLDIVIDE, FLMODULO (floating-point)
.br
Register variants: IADD_R, ISUB_R, IMUL_R, IDIV_R, IMOD_R, etc.
.RE
.PP
.B Mathematical Functions
.RS
SQRT, POW, LOG, EXP, SIN, COS, TAN
.br
Register variants: SQRT_R, POW_R, LOG_R, EXP_R, SIN_R, COS_R, TAN_R
.RE
.PP
.B Logical Operations
.RS
NOT, IAND, IOR, FLAND, FLOR, NEGATE
.br
Register variants: NOT_R, NEG_R, IAND_R, IOR_R, FLAND_R, FLOR_R
.RE
.PP
.B Comparison Operations
.RS
IEQUAL, INOT_EQUAL, ILESS_THAN, IGREATER_THAN, ILESS_EQUAL, IGREATER_EQUAL
.br
FLEQUAL, FLNOT_EQUAL, FLLESS_THAN, FLGREATER_THAN, FLLESS_EQUAL, FLGREATER_EQUAL
.br
Register variants: IEQ_R, INE_R, ILT_R, IGT_R, ILE_R, IGE_R, FLEQ_R, etc.
.RE
.PP
.B Control Flow
.RS
JUMP, JUMP_IF_FALSE, JUMP_IF_TRUE, JUMP_BACK, CALL, RETURN, HALT
.RE
.PP
.B Variable Operations
.RS
STORE_VAR, LOAD_VAR, LOAD_CONST_R, LOAD_VAR_R, STORE_VAR_R, MOV
.RE
.PP
.B I/O Operations
.RS
PRINT, PRINTERROR, READLINE, PRINT_R, PRINTERROR_R, READLINE_R
.RE
.PP
.B System Operations
.RS
CALL_NATIVE, SYSTEM, SYSTEM_R, IMPORT
.RE
.PP
.B String Operations
.RS
LEN, CHAR_AT, SUBSTR
.RE
.PP
.B Struct Operations
.RS
NEW_STRUCT, GET_FIELD, SET_FIELD, NEW_STRUCT_INSTANCE_STATIC, GET_FIELD_STATIC, SET_FIELD_STATIC
.RE
.PP
.B Constants
.RS
TRUE_P, FALSE_P, NULL_VAL
.RE
.SH STRING ESCAPING
Strings in the PHIR format use C-style escape sequences:
.RS
.IP \(bu 2
.B \en
- newline
.IP \(bu 2
.B \er
- carriage return
.IP \(bu 2
.B \et
- tab
.IP \(bu 2
.B \e\e
- backslash
.IP \(bu 2
.B \e"
- double quote
.RE
.SH EXAMPLE
A simple PHIR file:
.PP
.nf
.RS
\&.PHIR 4.0.0
\&.CONSTANTS 2
STRING "Hello, World!"
INT 42
\&.VARIABLES 1 1
x 0
\&.FUNCTIONS 1
main 0
\&.STRUCTS 0
\&.INSTRUCTIONS 5
LOAD_CONST_R r0, 0                      ; const[0]="Hello, World!"
PRINT_R r0
LOAD_CONST_R r1, 1                      ; const[1]=42
STORE_VAR_R r1, 0                       ; var=x
HALT
.RE
.fi
.SH USAGE
PHIR files can be:
.RS
.IP \(bu 2
Generated by
.BR phasorcompiler (1)
using the
.B --ir
flag
.IP \(bu 2
Manually edited for optimization or analysis
.IP \(bu 2
Used as input to
.BR phasornative (1)
for native code generation
.IP \(bu 2
Converted back to bytecode format
.RE
.SH ADVANTAGES
The PHIR format provides several benefits:
.RS
.IP \(bu 2
.B Human-readable
- Easy to inspect and understand compiled code
.IP \(bu 2
.B Editable
- Can be manually modified for optimization or debugging
.IP \(bu 2
.B Portable
- Text-based format works across platforms
.IP \(bu 2
.B Educational
- Helps understand the Phasor compilation process
.IP \(bu 2
.B Debugging
- Inline comments show variable names and constant values
.IP \(bu 2
.B Analysis
- Suitable for automated analysis tools
.RE
.SH VERSION COMPATIBILITY
The current PHIR format version is 4.0.0.
.RE
.SH SEE ALSO
.BR phasorcompiler (1),
.BR phasornative (1),
.BR phsb (5),
.BR phs (5)
.SH AUTHOR
Daniel McGuire
.SH COPYRIGHT
Copyright \(co 2026 Daniel McGuire

#!/usr/bin/env phasor
// Simple Shell
// (C) 2026 Daniel McGuire
// This file is licensed under the MIT License

using("stdio", "stdfile", "stdsys", "stdstr");

puts("Phasor Shell\n(C) 2026 Daniel McGuire\n");

fn trim(s: string) -> string {
    var out = "";
    var i = 0;
    var n = len(s);

    while (i < n && substr(s, i, 1) == " ") {
        i = i + 1;
    }

    while (i < n) {
        out = concat(out, substr(s, i, 1));
        i = i + 1;
    }

    var end = len(out) - 1;
    while (end >= 0 && substr(out, end, 1) == " ") {
        end = end - 1;
    }

    if (end < 0) return "";
    return substr(out, 0, end + 1);
}

fn starts_with(input: string, prefix: string) -> bool {
    if (len(input) < len(prefix)) return false;
    return substr(input, 0, len(prefix)) == prefix;
}

fn main() {
    while (true) {
        printf("%s$ ", fcd());

        var line = gets();

        line = trim(line);
        if (line.len() == 0) {
            continue;
        }

        if (starts_with(line, "exit")) {
            line = null;
            return 0;
        }

        if (line == null) {
            line = "";
            continue;
        }

        sys_execute(line);
    }
    return 0;
}

if (!main()) {
    puts_error("Unknown error");
}